rtmp {
        access_log /var/log/nginx/rtmp.log;
        server {
                listen 1935;
                allow play all;

                application show {
                        allow play all;
                        live on;
                        record all;
                        record_path /srv/nginx/drone/video_recordings;
                        record_unique on;
                        # Turn on HLS
                        hls on;
                        hls_nested on;
                        hls_path /srv/nginx/drone/hls/live;
                        exec ffmpeg -i rtmp://192.168.13.110:1935/show -threads 1 -c:v libx264 -profile:v baseline -b:v 350K -s 640x360 -f flv -c:a aac -ac 1 -strict -2 -b:a 56k rtmp://192.168.13.110:1935/mobile;
                        exec_record_done ffmpeg -i $path -c copy $dirname/$basename.mp4;
                        exec_record_done ffmpeg -i $path -ss 5 -frames:v 1 /srv/nginx/drone/icons/$basename.jpg;
                }
                application mobile {
                        allow play all;
                        live on;
                        # Turn on HLS
                        hls on;
                        hls_nested on;
                        hls_path /srv/nginx/drone/hls/mobile;
                        hls_fragment 10s;
                }
		            application vod {
                        play /srv/nginx/drone/video_recordings;
                }
        }
}
